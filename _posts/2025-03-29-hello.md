---
layout: post
title:  "파일 유형 파악"
date:   2025-03-29
categories: jekyll update
---
# 파일 유형 시그니처

- 의심 바이너리의 파일 유형 파악은 악성코드의 운영 체제 및 아키텍처를 정확히 식별하는 핵심 분석 과정이다.
    - 악성코드의 대상 플랫폼을 예측할 수 있는 중요한 단서는 파일의 구조와 특성에서 발견된다.
- `Portable Executable(PE)` 파일 유형은 윈도우 운영 체제를 대상으로 하는 악성코드임을 강력히 시사한다.
    - 파일 확장자는 신뢰할 수 없는 위장 기법일 수 있으므로, 정확한 파일 유형 식별을 위해서는 `파일 시그니처` 분석이 필수적이다.
	    - `파일 시그니처`는 파일의 맨 앞부분(헤더)에 존재하는 고유하고 특징적인 바이트 배열로, 실제 파일 유형을 판단하는 결정적 증거이다.

# Portable Executable (PE)

## 정의

- `PE`는 Windows 운영체제에서 실행 가능한 파일(EXE, DLL 등)의 파일 포맷(구조)을 의미
    - 윈도우 실행 파일 유형(예)
        - .exe (실행 파일)
        - .dll (동적 링크 라이브러리)
        - .sys (드라이버)
        - .ocx (ActiveX 컨트롤)

## PE 파일 구조

PE 파일은 여러 개의 헤더(Header)와 섹션(Section)으로 구성
```powershell
+---------------------+
| DOS Header (MZ)     | ← PE 파일은 항상 "MZ"로 시작함
+---------------------+
| DOS Stub            | ← "이 프로그램은 Windows에서 실행해야 합니다" 메시지 포함
+---------------------+
| PE Header (PE\\0\\0)| ← PE 파일의 핵심 정보가 들어 있음
+---------------------+
| File Header         | ← CPU 아키텍처, 섹션 개수, 컴파일 날짜 정보 포함
+---------------------+
| Optional Header     | ← 프로그램의 메모리 주소, 실행 진입점 포함
+---------------------+
| Section Table       | ← 코드, 데이터, 리소스 등 섹션 정보 포함
+---------------------+
| .text  (code)       | ← 실행할 코드가 저장됨
| .data  (data)       | ← 전역변수, 초기화된 데이터 저장
| .rdata (readonly)   | ← 문자열, Import Table 등이 포함됨
| .rsrc  (resource)   | ← 아이콘, UI 이미지 등 포함
+---------------------+
```

- 정상적인 PE 파일이라는 걸 의미
    ➡ **`4D 5A` = "MZ"** (고정된 자리)
    ➡ **`0x50 0x45 00 00`** = **PE\0\0** (실행 파일마다 위치가 변경)

